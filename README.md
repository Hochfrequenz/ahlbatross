<img src="https://raw.githubusercontent.com/Hochfrequenz/ahlbatross/main/ahlbatross.png" alt="ahlbatross.png">

# AHlBatross

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg?labelColor=30363D&color=fccccc)](LICENSE)
![Pypi status badge](https://img.shields.io/pypi/v/ahlbatross?labelColor=30363D&color=fccccc)
![Python Versions (officially) supported](https://img.shields.io/pypi/pyversions/ahlbatross.svg?labelColor=30363D&color=fccccc)

![Unittests status badge](https://github.com/Hochfrequenz/ahlbatross/workflows/Unittests/badge.svg)
![Coverage status badge](https://github.com/Hochfrequenz/ahlbatross/workflows/Coverage/badge.svg)
![Pylint status badge](https://github.com/Hochfrequenz/ahlbatross/workflows/Linting/badge.svg)
![Formatting status badge](https://github.com/Hochfrequenz/ahlbatross/workflows/Formatting/badge.svg)

Tool for comparing AHB (Anwendungshandbuch) documents across different format versions.
Compares Prüfidentifikators and stores the results in a SQLite database for further analysis.

## Installation
Install this package from [PyPI](https://pypi.org/project/ahlbatross/) using

```shell
pip install ahlbatross
```

## Usage

### Populate Comparison Database

To create comparison tables for all format version pairs in an existing AHB database:

```shell
ahlbatross populate-db path/to/ahb.db
```

For encrypted `.7z` archives, provide the password via `--password` or environment variable:

```shell
ahlbatross populate-db path/to/ahb.db.7z --password YOUR_PASSWORD

# Or via environment variable
export SQLITE_AHB_DB_7Z_ARCHIVE_PASSWORD=YOUR_PASSWORD
ahlbatross populate-db path/to/ahb.db.7z
```

This command:
- Finds all format versions present in the database
- Compares all Prüfidentifikators across all pairs of format versions
- Creates and populates `ahb_line_comparison` and `ahb_comparison_summary` tables
- Vacuums the database for optimal performance
- For encrypted archives: decrypts, processes, and re-encrypts with the same password

The comparison tables can then be queried to find changes between any two format versions.

## Development Setup

To set up the python development environment, install the required dependencies via

```shell
$ tox -e dev
```

For local testing and code quality maintenance, run 

```shell
tox
```

Check out our [Python Template Repository](https://github.com/Hochfrequenz/python_template_repository#how-to-use-this-repository-on-your-machine) 
for detailed descriptions and step-by-step instructions.

### Release Workflow / CD
To publish a new version of this library on PyPI [create a new release](https://github.com/Hochfrequenz/ahlbatross/releases/new).
Use semantic versioning with leading `v`, e.g. `v1.2.3` and please include at least the autogenerated release notes.

## Contribute

Feel free to contribute to this project by opening a pull request against the main branch.
